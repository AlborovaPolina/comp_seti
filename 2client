#include <iostream>
#include <cstring>
#include <winsock2.h>
#include <ws2tcpip.h>
#pragma comment(lib, "ws2_32.lib")

using namespace std;

struct Student {
    char name[64];
    char faculty[64];
    int marks[4];
};

enum Scholarship {
    NO = 0,
    ORDINARY = 1,
    HIGH = 2
};

int main() {
    setlocale(LC_ALL, "Russian");

    WSADATA wsaData;
    if (WSAStartup(MAKEWORD(2, 2), &wsaData) != 0) {
        cerr << "Ошибка инициализации Winsock\n";
        return 1;
    }

    SOCKET clientSocket = socket(AF_INET, SOCK_STREAM, 0);

    sockaddr_in serverAddr{};
    serverAddr.sin_family = AF_INET;
    serverAddr.sin_port = htons(12345);
    inet_pton(AF_INET, "127.0.0.1", &serverAddr.sin_addr);

    if (connect(clientSocket, (sockaddr*)&serverAddr, sizeof(serverAddr)) != 0) {
        cerr << "Ошибка подключения\n";
        closesocket(clientSocket);
        WSACleanup();
        return 1;
    }

    cout << "Подключено к серверу\n";

    while (true) {
        Student st{};
        string input;

        cout << "\nВведите ФИО (или 'exit' для выхода): ";
        cin.getline(st.name, sizeof(st.name));
        if (string(st.name) == "exit") {
            break;
        }

        cout << "Введите факультет: ";
        cin.getline(st.faculty, sizeof(st.faculty));

        cout << "Введите 4 оценки: ";
        for (int i = 0; i < 4; i++) {
            cin >> st.marks[i];
        }
        cin.ignore();

        if (send(clientSocket, (char*)&st, sizeof(st), 0) == SOCKET_ERROR) {
            cerr << "Ошибка отправки данных\n";
            break;
        }

        Scholarship result{};
        int recvSize = recv(clientSocket, (char*)&result, sizeof(result), 0);
        if (recvSize <= 0) {
            cerr << "Ошибка получения данных\n";
            break;
        }

        switch (result) {
        case NO:
            cout << "Стипендия: нет\n";
            break;
        case ORDINARY:
            cout << "Стипендия: обычная\n";
            break;
        case HIGH:
            cout << "Стипендия: повышенная\n";
            break;
        default:
            cout << "Неизвестный результат\n";
        }
    }

    closesocket(clientSocket);
    WSACleanup();
}
